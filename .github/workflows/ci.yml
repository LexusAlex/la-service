name: la-service pipeline

on:
    push:
        branches:
            - main

jobs:
    build:
        runs-on: ubuntu-20.04
        steps:
            - uses: actions/checkout@v2
            # Делаем какую-то подготовительную работу типа тесты и линтеры
            - name:
              run: set -eu
              run: mkdir "$HOME/.ssh"
              run: echo "$" > "$HOME/.ssh/PRODUCTION_KEY"
              run: chmod 600 "$HOME/.ssh/PRODUCTION_KEY"
              if: ${{ github.ref == 'refs/heads/main' }}
            - name:
              run: make deploy
              env:
                  HOST: ${{ secrets.PRODUCTION_HOST }}
                  PORT: ${{ secrets.PRODUCTION_PORT }}
              if: ${{ github.ref == 'refs/heads/main' }}